
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A collection of hand-crafted extensions for your Kotlin projects.">
      
      
        <link rel="canonical" href="https://LouisCAD.github.io/Splitties/3/coroutines/">
      
      
        <meta name="author" content="LouisCAD">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.0.2">
    
    
      
        <title>coroutines - Splitties</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.38780c08.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.3f72e892.min.css">
        
          
          
          <meta name="theme-color" content="#009485">
        
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../../app.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="teal" data-md-color-accent="white">
      
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#coroutines" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://LouisCAD.github.io/Splitties/" title="Splitties" class="md-header-nav__button md-logo" aria-label="Splitties">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Splitties
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              coroutines
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/LouisCAD/Splitties/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Splitties
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://LouisCAD.github.io/Splitties/" title="Splitties" class="md-nav__button md-logo" aria-label="Splitties">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Splitties
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/LouisCAD/Splitties/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Splitties
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../CHANGELOG/" class="md-nav__link">
      Change Log
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Splitties 3
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Splitties 3" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon"></span>
        Splitties 3
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../activities/" class="md-nav__link">
      activities
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../alertdialog-appcompat-coroutines/" class="md-nav__link">
      alertdialog-appcompat-coroutines
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../alertdialog-appcompat/" class="md-nav__link">
      alertdialog-appcompat
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../alertdialog-material/" class="md-nav__link">
      alertdialog-material
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../alertdialog/" class="md-nav__link">
      alertdialog
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../appctx/" class="md-nav__link">
      appctx
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../arch-lifecycle/" class="md-nav__link">
      arch-lifecycle
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../arch-room/" class="md-nav__link">
      arch-room
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../bitflags/" class="md-nav__link">
      bitflags
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../bundle/" class="md-nav__link">
      bundle
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../checkedlazy/" class="md-nav__link">
      checkedlazy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../collections/" class="md-nav__link">
      collections
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        coroutines
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" class="md-nav__link md-nav__link--active">
      coroutines
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#offering-a-value-to-a-sendchannel-including-inside-callbackflow-safely" class="md-nav__link">
    Offering a value to a SendChannel (including inside callbackFlow) safely
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cancellable-infinite-loops" class="md-nav__link">
    Cancellable infinite loops
  </a>
  
    <nav class="md-nav" aria-label="Cancellable infinite loops">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    Example:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#racing-coroutines" class="md-nav__link">
    Racing coroutines
  </a>
  
    <nav class="md-nav" aria-label="Racing coroutines">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#number-of-racers-fixed-at-compile-time" class="md-nav__link">
    Number of racers fixed at compile time
  </a>
  
    <nav class="md-nav" aria-label="Number of racers fixed at compile time">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simple-example-unit-test" class="md-nav__link">
    Simple example (unit test):
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ui-code-example" class="md-nav__link">
    UI code example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-racers-and-late-racers" class="md-nav__link">
    Dynamic racers and late racers
  </a>
  
    <nav class="md-nav" aria-label="Dynamic racers and late racers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example_1" class="md-nav__link">
    Example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#await-cancellation" class="md-nav__link">
    Await cancellation
  </a>
  
    <nav class="md-nav" aria-label="Await cancellation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ui-code-example-with-tryfinally" class="md-nav__link">
    UI code example with try/finally
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#suspending-version-of-lazy" class="md-nav__link">
    Suspending version of lazy
  </a>
  
    <nav class="md-nav" aria-label="Suspending version of lazy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-initializing-a-database-only-once" class="md-nav__link">
    Example: Initializing a database only once
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-offloading-heavy-object-instantiation-or-expensive-computation" class="md-nav__link">
    Example: Offloading heavy object instantiation or expensive computation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#download" class="md-nav__link">
    Download
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dimensions/" class="md-nav__link">
      dimensions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../exceptions/" class="md-nav__link">
      exceptions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../fragmentargs/" class="md-nav__link">
      fragmentargs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../fragments/" class="md-nav__link">
      fragments
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../initprovider/" class="md-nav__link">
      initprovider
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../intents/" class="md-nav__link">
      intents
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lifecycle-coroutines/" class="md-nav__link">
      lifecycle-coroutines
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../mainhandler/" class="md-nav__link">
      mainhandler
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../mainthread/" class="md-nav__link">
      mainthread
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../material-colors/" class="md-nav__link">
      material-colors
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../material-lists/" class="md-nav__link">
      material-lists
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../permissions/" class="md-nav__link">
      permissions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../preferences/" class="md-nav__link">
      preferences
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../resources/" class="md-nav__link">
      resources
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sample-android-app/" class="md-nav__link">
      sample-android-app
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../snackbar/" class="md-nav__link">
      snackbar
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../stetho-init/" class="md-nav__link">
      stetho-init
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../systemservices/" class="md-nav__link">
      systemservices
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../toast/" class="md-nav__link">
      toast
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../typesaferecyclerview/" class="md-nav__link">
      typesaferecyclerview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../views-appcompat/" class="md-nav__link">
      views-appcompat
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../views-cardview/" class="md-nav__link">
      views-cardview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../views-coroutines-material/" class="md-nav__link">
      views-coroutines-material
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../views-coroutines/" class="md-nav__link">
      views-coroutines
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../views-dsl-appcompat/" class="md-nav__link">
      views-dsl-appcompat
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../views-dsl-constraintlayout/" class="md-nav__link">
      views-dsl-constraintlayout
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../views-dsl-coordinatorlayout/" class="md-nav__link">
      views-dsl-coordinatorlayout
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../views-dsl-ide-preview/" class="md-nav__link">
      views-dsl-ide-preview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../views-dsl-material/" class="md-nav__link">
      views-dsl-material
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../views-dsl-recyclerview/" class="md-nav__link">
      views-dsl-recyclerview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../views-dsl/" class="md-nav__link">
      views-dsl
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../views-material/" class="md-nav__link">
      views-material
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../views-recyclerview/" class="md-nav__link">
      views-recyclerview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../views-selectable-appcompat/" class="md-nav__link">
      views-selectable-appcompat
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../views-selectable-constraintlayout/" class="md-nav__link">
      views-selectable-constraintlayout
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../views-selectable/" class="md-nav__link">
      views-selectable
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../views/" class="md-nav__link">
      views
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Splitties 2
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Splitties 2" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon"></span>
        Splitties 2
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../2/" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2/CHANGELOG/" class="md-nav__link">
      CHANGELOG
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2/Kotlin-UIs-vs-xml-layouts/" class="md-nav__link">
      Kotlin-UIs-vs-xml-layouts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2/activities/" class="md-nav__link">
      activities
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2/alertdialog-appcompat/" class="md-nav__link">
      alertdialog-appcompat
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2/alertdialog/" class="md-nav__link">
      alertdialog
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2/appctx/" class="md-nav__link">
      appctx
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2/arch-lifecycle/" class="md-nav__link">
      arch-lifecycle
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2/arch-room/" class="md-nav__link">
      arch-room
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2/bitflags/" class="md-nav__link">
      bitflags
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2/bundle/" class="md-nav__link">
      bundle
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2/checkedlazy/" class="md-nav__link">
      checkedlazy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2/collections/" class="md-nav__link">
      collections
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2/dimensions/" class="md-nav__link">
      dimensions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2/exceptions/" class="md-nav__link">
      exceptions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2/fragmentargs/" class="md-nav__link">
      fragmentargs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2/fragments/" class="md-nav__link">
      fragments
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2/initprovider/" class="md-nav__link">
      initprovider
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2/intents/" class="md-nav__link">
      intents
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2/mainhandler/" class="md-nav__link">
      mainhandler
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2/mainthread/" class="md-nav__link">
      mainthread
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2/material-colors/" class="md-nav__link">
      material-colors
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2/material-lists/" class="md-nav__link">
      material-lists
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2/preferences/" class="md-nav__link">
      preferences
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2/resources/" class="md-nav__link">
      resources
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2/sample/" class="md-nav__link">
      sample
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2/snackbar/" class="md-nav__link">
      snackbar
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2/stetho-init/" class="md-nav__link">
      stetho-init
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2/systemservices/" class="md-nav__link">
      systemservices
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2/toast/" class="md-nav__link">
      toast
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2/typesaferecyclerview/" class="md-nav__link">
      typesaferecyclerview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2/views-appcompat/" class="md-nav__link">
      views-appcompat
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2/views-cardview/" class="md-nav__link">
      views-cardview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2/views-design/" class="md-nav__link">
      views-design
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2/views-dsl-appcompat/" class="md-nav__link">
      views-dsl-appcompat
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2/views-dsl-constraintlayout/" class="md-nav__link">
      views-dsl-constraintlayout
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2/views-dsl-design/" class="md-nav__link">
      views-dsl-design
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2/views-dsl-ide-preview/" class="md-nav__link">
      views-dsl-ide-preview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2/views-dsl-recyclerview/" class="md-nav__link">
      views-dsl-recyclerview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2/views-dsl/" class="md-nav__link">
      views-dsl
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2/views-recyclerview/" class="md-nav__link">
      views-recyclerview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2/views-selectable-appcompat/" class="md-nav__link">
      views-selectable-appcompat
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2/views-selectable-constraintlayout/" class="md-nav__link">
      views-selectable-constraintlayout
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2/views-selectable/" class="md-nav__link">
      views-selectable
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2/views/" class="md-nav__link">
      views
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../RELEASING/" class="md-nav__link">
      Releasing
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#offering-a-value-to-a-sendchannel-including-inside-callbackflow-safely" class="md-nav__link">
    Offering a value to a SendChannel (including inside callbackFlow) safely
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cancellable-infinite-loops" class="md-nav__link">
    Cancellable infinite loops
  </a>
  
    <nav class="md-nav" aria-label="Cancellable infinite loops">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    Example:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#racing-coroutines" class="md-nav__link">
    Racing coroutines
  </a>
  
    <nav class="md-nav" aria-label="Racing coroutines">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#number-of-racers-fixed-at-compile-time" class="md-nav__link">
    Number of racers fixed at compile time
  </a>
  
    <nav class="md-nav" aria-label="Number of racers fixed at compile time">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simple-example-unit-test" class="md-nav__link">
    Simple example (unit test):
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ui-code-example" class="md-nav__link">
    UI code example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-racers-and-late-racers" class="md-nav__link">
    Dynamic racers and late racers
  </a>
  
    <nav class="md-nav" aria-label="Dynamic racers and late racers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example_1" class="md-nav__link">
    Example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#await-cancellation" class="md-nav__link">
    Await cancellation
  </a>
  
    <nav class="md-nav" aria-label="Await cancellation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ui-code-example-with-tryfinally" class="md-nav__link">
    UI code example with try/finally
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#suspending-version-of-lazy" class="md-nav__link">
    Suspending version of lazy
  </a>
  
    <nav class="md-nav" aria-label="Suspending version of lazy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-initializing-a-database-only-once" class="md-nav__link">
    Example: Initializing a database only once
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-offloading-heavy-object-instantiation-or-expensive-computation" class="md-nav__link">
    Example: Offloading heavy object instantiation or expensive computation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#download" class="md-nav__link">
    Download
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/LouisCAD/Splitties/edit/master/docs/3/coroutines.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="coroutines">Coroutines<a class="headerlink" href="#coroutines" title="Permanent link">&para;</a></h1>
<p><em>General purpose extensions to kotlinx.coroutines.</em></p>
<p>Supported platforms: <strong>Linux</strong> (x64), <strong>MingW (x64)</strong>, <strong>macOS</strong> (x64), <strong>iOS</strong> (arm32, arm64 &amp; x64), <strong>JS</strong>, <strong>JVM</strong> (including Android).</p>
<h2 id="offering-a-value-to-a-sendchannel-including-inside-callbackflow-safely">Offering a value to a <code>SendChannel</code> (including inside <code>callbackFlow</code>) safely<a class="headerlink" href="#offering-a-value-to-a-sendchannel-including-inside-callbackflow-safely" title="Permanent link">&para;</a></h2>
<p>Calling the <code>offer</code> function in <code>SendChannel</code> as it can crash your program if the channel is closed,
as can be seen in this issue: <a href="https://github.com/Kotlin/kotlinx.coroutines/issues/974">https://github.com/Kotlin/kotlinx.coroutines/issues/974</a>.</p>
<p>To be safe from this pitfall, Splitties provides an extension named <code>offerCatching(…)</code> that returns
<code>false</code> if <code>offer</code> throws, making you safe in the edge cases where a call is made just after the
channel gets closed, as can happen when using <code>callbackFlow { … }</code> in multi-threaded environments.</p>
<h2 id="cancellable-infinite-loops">Cancellable infinite loops<a class="headerlink" href="#cancellable-infinite-loops" title="Permanent link">&para;</a></h2>
<p>The <code>repeatWhileActive { … }</code> top level function is like a <code>while (true) { … }</code> loop, except that:
- it evaluates to <code>Nothing</code>, allowing you to use it in any lambda, regardless of its return type.
- it will check for cancellation before each execution of the passed lambda, protecting from an
infinite loop if the code in the lambda doesn&rsquo;t check for cancellation but eventually ends running.</p>
<p>It also has an overload that takes a <code>Boolean</code> parameter named <code>ignoreInnerCancellations</code>. This one
is made for the cases where you&rsquo;re throwing a <code>CancellationException</code> to signal the cancellation of
this loop run/iteration, but want to continue looping again. Can be useful if you are using
<code>withTimeout { … }</code> or want to easily handle user requested cancellation. It will still check that
the scope has not been cancelled before each iteration, so it&rsquo;s perfectly safe to use among code
that must be cancellable.</p>
<h4 id="example">Example:<a class="headerlink" href="#example" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="n">suspend</span> <span class="k">fun</span> <span class="nf">doStuffUntilCancelled</span><span class="p">(</span><span class="n">ui</span><span class="p">:</span> <span class="n">SomeUi</span><span class="p">,</span> <span class="n">someObject</span><span class="p">:</span> <span class="n">SomeType</span><span class="p">):</span> <span class="n">Nothing</span> <span class="p">{</span>
    <span class="n">repeatWhileActive</span> <span class="p">{</span>
        <span class="k">val</span> <span class="py">command</span> <span class="p">=</span> <span class="n">ui</span><span class="p">.</span><span class="n">awaitSomeUserAction</span><span class="p">()</span>
        <span class="n">someObject</span><span class="p">.</span><span class="n">doSomething</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="n">whatever</span><span class="p">)</span>
        <span class="n">ui</span><span class="p">.</span><span class="n">awaitAnotherUserAction</span><span class="p">()</span>
        <span class="k">val</span> <span class="py">result</span> <span class="p">=</span> <span class="n">someObject</span><span class="p">.</span><span class="n">doSomethingElse</span><span class="p">()</span>
        <span class="n">ui</span><span class="p">.</span><span class="n">showOutcome</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="racing-coroutines">Racing coroutines<a class="headerlink" href="#racing-coroutines" title="Permanent link">&para;</a></h2>
<h3 id="number-of-racers-fixed-at-compile-time">Number of racers fixed at compile time<a class="headerlink" href="#number-of-racers-fixed-at-compile-time" title="Permanent link">&para;</a></h3>
<p>The <code>raceOf(…)</code> function takes a variable number of coroutines, that also have a <code>CoroutineScope</code> as
a receiver. The first coroutine to finish (includes that any child coroutines that might have been
launched are completed or cancelled too) will cancel the others, and its value will be returned by
<code>raceOf</code>.</p>
<p><em>Note that calling <code>raceOf</code> with no racers is forbidden, and any attempt to do so will throw an
<code>IllegalArgumentException</code>. There&rsquo;s a deprecated overload of <code>raceOf()</code> taking no parameters to
prevent you from making this mistake. For variable number of racing coroutines, use <code>race</code> +
<code>launchRacer</code> documented below.</em></p>
<h4 id="simple-example-unit-test">Simple example (unit test):<a class="headerlink" href="#simple-example-unit-test" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="n">suspend</span> <span class="k">fun</span> <span class="nf">testCoroutinesRacing</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">val</span> <span class="py">result</span> <span class="p">=</span> <span class="n">raceOf</span><span class="p">({</span>
        <span class="n">delay</span><span class="p">(</span><span class="m">3</span><span class="p">)</span>
        <span class="s">&quot;slow&quot;</span>
    <span class="p">},</span> <span class="p">{</span>
        <span class="n">delay</span><span class="p">(</span><span class="m">0</span><span class="p">)</span>
        <span class="s">&quot;fast&quot;</span>
    <span class="p">})</span>
    <span class="n">assertEquals</span><span class="p">(</span><span class="n">expected</span> <span class="p">=</span> <span class="s">&quot;fast&quot;</span><span class="p">,</span> <span class="n">actual</span> <span class="p">=</span> <span class="n">result</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="ui-code-example">UI code example<a class="headerlink" href="#ui-code-example" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="n">suspend</span> <span class="k">fun</span> <span class="nf">awaitUserChoice</span><span class="p">(</span><span class="n">ui</span><span class="p">:</span> <span class="n">SomeUi</span><span class="p">,</span> <span class="n">choices</span><span class="p">:</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Stuff</span><span class="p">&gt;):</span> <span class="n">Stuff</span><span class="p">?</span> <span class="p">=</span> <span class="n">raceOf</span><span class="p">({</span>
    <span class="n">ui</span><span class="p">.</span><span class="n">awaitSomeUserAction</span><span class="p">(</span><span class="n">choices</span><span class="p">)</span>
<span class="p">},</span> <span class="p">{</span>
    <span class="n">ui</span><span class="p">.</span><span class="n">awaitDismissal</span><span class="p">()</span>
    <span class="k">null</span>
<span class="p">},</span> <span class="p">{</span>
    <span class="n">launch</span> <span class="p">{</span>
        <span class="n">doSideStuff</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="n">ui</span><span class="p">.</span><span class="n">showSomethingInRealtimeUntilCancelled</span><span class="p">()</span> <span class="c1">// Returns Nothing, will run, but never &quot;win&quot;.</span>
<span class="p">})</span>
</code></pre></div>
<h3 id="dynamic-racers-and-late-racers">Dynamic racers and late racers<a class="headerlink" href="#dynamic-racers-and-late-racers" title="Permanent link">&para;</a></h3>
<p>The <code>raceOf(…)</code> function might not suit your use case if the racing coroutines need to be
launched based on some conditions, that might also take some time to be evaluated.</p>
<p>These more advanced use-cases are satisfied by the <code>race { … }</code> function, where you can call
<code>launchRacer { … }</code> in its lambda.</p>
<p>If no racing coroutines are ever launched, the <code>race { … }</code> function will suspend until it is
cancelled.</p>
<h4 id="example_1">Example<a class="headerlink" href="#example_1" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="n">suspend</span> <span class="k">fun</span> <span class="nf">awaitSomeActionTrigger</span><span class="p">(</span>
    <span class="n">config</span><span class="p">:</span> <span class="n">SomeConfig</span><span class="p">,</span>
    <span class="n">deviceCapabilities</span><span class="p">:</span> <span class="n">HardwareSupportInfo</span><span class="p">,</span>
    <span class="n">defaultInput</span><span class="p">:</span> <span class="n">SomeInput</span><span class="p">,</span>
    <span class="n">awaitSpecialInput</span><span class="p">:</span> <span class="n">suspend</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="n">Unit</span>
<span class="p">)</span> <span class="p">{</span>
    <span class="n">race</span> <span class="p">{</span>
        <span class="n">launchRacer</span> <span class="p">{</span> <span class="n">defaultInput</span><span class="p">.</span><span class="n">awaitSomeAction</span><span class="p">()</span> <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">deviceCapabilities</span><span class="p">.</span><span class="n">supportsSpecialInput</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">launchRacer</span> <span class="p">{</span> <span class="n">awaitSpecialInput</span><span class="p">()</span> <span class="p">}</span>
            <span class="n">delay</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">delayBeforeHintMillis</span><span class="p">)</span> <span class="c1">// The race lambda can suspend</span>
            <span class="n">showHintForSpecialInput</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="await-cancellation">Await cancellation<a class="headerlink" href="#await-cancellation" title="Permanent link">&para;</a></h2>
<p>In code that embraces coroutines capabilities like being able to run some code on cancellation
(for example with a <code>finally</code> block encompassing suspending code), it can be handy to suspend a
coroutine until it is cancelled, for example to delay the hiding of a part of a UI, or stop an
ongoing side operation that is not needed after cancellation.</p>
<p>So Splitties provides a function named <code>awaitCancellation()</code> that returns <code>Nothing</code> so you can
use it in any suspending code when needed.</p>
<h4 id="ui-code-example-with-tryfinally">UI code example with <code>try</code>/<code>finally</code><a class="headerlink" href="#ui-code-example-with-tryfinally" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="n">suspend</span> <span class="k">fun</span> <span class="nf">showStuffUntilCancelled</span><span class="p">(</span><span class="k">data</span><span class="p">:</span> <span class="n">Stuff</span><span class="p">):</span> <span class="n">Nothing</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="n">someSubView</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="k">data</span><span class="p">.</span><span class="n">title</span>
        <span class="n">anotherSubView</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="k">data</span><span class="p">.</span><span class="n">description</span>
        <span class="n">someView</span><span class="p">.</span><span class="n">isVisible</span> <span class="p">=</span> <span class="k">true</span>
        <span class="n">awaitCancellation</span><span class="p">()</span> <span class="c1">// Suspends so the view stays visible</span>
    <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
        <span class="n">someView</span><span class="p">.</span><span class="n">isVisible</span> <span class="p">=</span> <span class="k">false</span> <span class="c1">// Called on cancellation, cannot forget to hide the view!</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Same version using <code>visibleInScope</code> from <a href="../views-coroutines/">Views Coroutines</a>:
<div class="highlight"><pre><span></span><code><span class="n">suspend</span> <span class="k">fun</span> <span class="nf">showStuffUntilCancelled</span><span class="p">(</span><span class="k">data</span><span class="p">:</span> <span class="n">Stuff</span><span class="p">):</span> <span class="n">Nothing</span> <span class="p">{</span>
    <span class="n">someSubView</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="k">data</span><span class="p">.</span><span class="n">title</span>
    <span class="n">anotherSubView</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="k">data</span><span class="p">.</span><span class="n">description</span>
    <span class="n">someView</span><span class="p">.</span><span class="n">visibleInScope</span> <span class="p">{</span>
        <span class="n">awaitCancellation</span><span class="p">()</span> <span class="c1">// Suspends so the view stays visible</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<h2 id="suspending-version-of-lazy">Suspending version of <code>lazy</code><a class="headerlink" href="#suspending-version-of-lazy" title="Permanent link">&para;</a></h2>
<p>These 3 functions provide a <code>SuspendLazy</code> instance:</p>
<ul>
<li><code>CoroutineScope.suspendLazy { … }</code></li>
<li><code>suspendBlockingLazy { … }</code> (uses <code>Dispatchers.Default</code> by default)</li>
<li><code>suspendBlockingLazyIO { … }</code> (JVM-only for now, uses <code>Dispatchers.IO</code>)</li>
</ul>
<p>They can be used almost like Kotlin&rsquo;s <code>lazy</code>, but you need parentheses to get the value.</p>
<p>Note that if an <code>Exception</code> or any <code>Throwable</code> is thrown in their initializing lambda,
the <code>SuspendLazy</code> instance will not be recoverable, so if retry logic is needed, it must
include instantiating a new <code>SuspendLazy</code>. <em>If you want it to allow retries on the same instance,
please open an issue and tell about your use case.</em></p>
<h4 id="example-initializing-a-database-only-once">Example: Initializing a database only once<a class="headerlink" href="#example-initializing-a-database-only-once" title="Permanent link">&para;</a></h4>
<p>For an app-wide remote database:
<div class="highlight"><pre><span></span><code><span class="k">val</span> <span class="py">db</span><span class="p">:</span> <span class="n">SomeDatabase</span> <span class="p">=</span> <span class="n">GlobalScope</span><span class="p">.</span><span class="n">suspendLazy</span> <span class="p">{</span>
    <span class="n">createDatabase</span><span class="p">().</span><span class="n">also</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span> <span class="p">}</span> <span class="c1">// Both functions suspend</span>
<span class="p">}</span>

<span class="k">fun</span> <span class="nf">doStuff</span><span class="p">(</span><span class="n">someData</span><span class="p">:</span> <span class="n">SomeData</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">db</span><span class="p">().</span><span class="n">runSomeTransaction</span><span class="p">(</span><span class="n">someData</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></p>
<p>For an application-wide local database (e.g. in an Android or desktop JVM app):
<div class="highlight"><pre><span></span><code><span class="k">val</span> <span class="py">db</span><span class="p">:</span> <span class="n">AppDatabase</span> <span class="p">=</span> <span class="n">suspendBlockingLazyIO</span> <span class="p">{</span> <span class="n">buildDatabase</span><span class="p">()</span> <span class="p">}</span>

<span class="k">fun</span> <span class="nf">doStuff</span><span class="p">(</span><span class="n">someData</span><span class="p">:</span> <span class="n">SomeData</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">db</span><span class="p">().</span><span class="n">runSomeTransaction</span><span class="p">(</span><span class="n">someData</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></p>
<p>Passing a <code>SuspendLazy</code> type can be handy:
<div class="highlight"><pre><span></span><code><span class="n">suspend</span> <span class="k">fun</span> <span class="nf">doStuff</span><span class="p">(</span><span class="n">getDb</span><span class="p">:</span> <span class="n">SuspendLazy</span><span class="p">&lt;</span><span class="n">AppDatabase</span><span class="p">&gt;,</span> <span class="n">someData</span><span class="p">:</span> <span class="n">SomeData</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">val</span> <span class="py">db</span> <span class="p">=</span> <span class="n">getDb</span><span class="p">()</span>
    <span class="n">db</span><span class="p">.</span><span class="n">runSomeTransaction</span><span class="p">(</span><span class="n">someData</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></p>
<h4 id="example-offloading-heavy-object-instantiation-or-expensive-computation">Example: Offloading heavy object instantiation or expensive computation<a class="headerlink" href="#example-offloading-heavy-object-instantiation-or-expensive-computation" title="Permanent link">&para;</a></h4>
<p>Objects that need a significant amount of memory (example bitmap/images, large arrays/lists, or
large/deep data structures such as possibly non trivial trees) will block the current thread while
being instantiated, waiting for the CPU to find enough free memory (RAM), which might include moving
lots of stuff to have the contiguous space that can be required.</p>
<p>To avoid blocking the user interface and altering the perceived performance of the application,
you need to not run such code on the main/UI thread, but offload it to another thread such as one
from <code>Dispatchers.Default</code>. The <code>suspendBlockingLazy { … }</code> makes it very easy to do it right:</p>
<div class="highlight"><pre><span></span><code><span class="k">val</span> <span class="py">expensiveThing</span> <span class="p">=</span> <span class="n">suspendBlockingLazy</span> <span class="p">{</span> <span class="n">DoHeavyInstantiation</span><span class="p">()</span> <span class="p">}</span>

<span class="k">fun</span> <span class="nf">doStuff</span><span class="p">(</span><span class="n">ui</span><span class="p">:</span> <span class="n">SomeUi</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Can run on main/UI thread.</span>
    <span class="k">val</span> <span class="py">thing</span> <span class="p">=</span> <span class="n">expensiveThing</span><span class="p">()</span> <span class="c1">// Will suspend until DoHeavyInstantiation() is done.</span>
    <span class="n">ui</span><span class="p">.</span><span class="n">displaySomeDataNicely</span><span class="p">(</span><span class="n">thing</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="download">Download<a class="headerlink" href="#download" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="n">implementation</span><span class="o">(</span><span class="s2">&quot;com.louiscad.splitties:splitties-coroutines:3.0.0-beta01&quot;</span><span class="o">)</span>
</code></pre></div>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../collections/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                collections
              </div>
            </div>
          </a>
        
        
          <a href="../dimensions/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                dimensions
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2020 jmfayard
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.77e55a48.min.js"></script>
      <script src="../../assets/javascripts/bundle.9554a270.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>